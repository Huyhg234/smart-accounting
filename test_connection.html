<!doctype html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <title>Test Firebase Connection</title>
  </head>
  <body>
    <h1>Ki·ªÉm tra k·∫øt n·ªëi Firebase</h1>
    <div id="status">ƒêang k·∫øt n·ªëi...</div>
    <ul id="logs"></ul>

    <script type="module">
      import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
      import {
        getFirestore,
        collection,
        addDoc,
        getDocs,
      } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";

      // C·∫•u h√¨nh c·ªßa b·∫°n
      const firebaseConfig = {
        apiKey: "AIzaSyBN5FD1B9x6mIPfZoqMCC8igNv1dgr6bKw",
        authDomain: "smartaccounting-saas.firebaseapp.com",
        projectId: "smartaccounting-saas",
        storageBucket: "smartaccounting-saas.firebasestorage.app",
        messagingSenderId: "41111074288",
        appId: "1:41111074288:web:b9feb5cf6f7af1432b9935",
        measurementId: "G-LL9YG9HYPQ",
      };

      const app = initializeApp(firebaseConfig);
      const db = getFirestore(app);
      const statusDiv = document.getElementById("status");
      const logsUl = document.getElementById("logs");

      function log(msg, color = "black") {
        const li = document.createElement("li");
        li.style.color = color;
        li.textContent = msg;
        logsUl.appendChild(li);
      }

      async function runTest() {
        try {
          log("ƒêang th·ª≠ ghi d·ªØ li·ªáu m·∫´u...");
          const docRef = await addDoc(collection(db, "TEST_CONNECTION"), {
            message: "Xin ch√†o Admin Huy! K·∫øt n·ªëi th√†nh c√¥ng.",
            timestamp: new Date().toISOString(),
          });

          log(`‚úÖ Ghi th√†nh c√¥ng! ID: ${docRef.id}`, "green");
          statusDiv.textContent = "K·∫æT N·ªêI TH√ÄNH C√îNG!";
          statusDiv.style.color = "green";
        } catch (e) {
          console.error(e);
          log(`‚ùå L·ªói: ${e.message}`, "red");
          statusDiv.textContent = "K·∫æT N·ªêI TH·∫§T B·∫†I";
          statusDiv.style.color = "red";

          if (e.message.includes("permission-denied")) {
            log(
              "üí° G·ª£i √Ω: H√£y ki·ªÉm tra Security Rules (ch·ªçn 'Start in test mode')",
              "orange",
            );
          }
        }
      }

      runTest();
    </script>
  </body>
</html>
